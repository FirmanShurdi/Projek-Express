"use strict";var express=require("express"),router=express.Router(),db=require("../db");router.get("/kategori",function(e,r){db.query("SELECT * FROM kategori",function(e,a){if(e)return console.error("Gagal mengambil kategori:",e),r.status(500).send("Gagal memuat kategori");r.render("kategori/index",{kategoriList:a})})}),router.get("/",function(e,u){var k=e.query.kategori||null,g=parseInt(e.query.page)||1,t=6*(g-1),s="true"===e.query.all,n="SELECT o.*, k.nama_kategori FROM objek o LEFT JOIN kategori k ON o.kategori_id = k.id",d="",l=[];k&&(d=" WHERE k.nama_kategori = ? ",l.push(k)),db.query("SELECT COUNT(*) AS total FROM objek o LEFT JOIN kategori k ON o.kategori_id = k.id"+d,l,function(e,a){if(e)return console.error("Gagal mengambil jumlah data:",e),u.status(500).send("Gagal memuat data");var r,o=a[0].total,i=Math.ceil(o/6);s?(r=n+d+" ORDER BY o.id DESC",g=1):(r=n+d+" ORDER BY o.id DESC LIMIT ? OFFSET ?",[].concat(l,[6,t])),db.query(r,[].concat(l,[6,t]),function(e,o){if(e)return console.error("Gagal mengambil data objek:",e),u.status(500).send("Gagal memuat objek");var a=o.map(function(e){return e.id}),r="\n        SELECT o.*, k.nama_kategori\n        FROM objek o\n        LEFT JOIN kategori k ON o.kategori_id = k.id\n      ",t=[];if(0<a.length){var n=a.map(function(){return"?"}).join(", ");r+=" WHERE o.id NOT IN (".concat(n,") "),t=a}r+=" ORDER BY RAND() LIMIT 10",db.query(r,t,function(e,r){if(e)return console.error("Gagal mengambil carousel:",e),u.status(500).send("Gagal memuat carousel");db.query("SELECT * FROM kategori",function(e,a){if(e)return console.error("Gagal mengambil kategori:",e),u.status(500).send("Gagal memuat kategori");u.render("objek",{objekList:o,carouselItems:r,totalPages:i,currentPage:g,kategoriAktif:k,kategoriList:a,tampilkanSemua:s})})})})})}),router.get("/semua",function(e,r){db.query("\n    SELECT o.*, k.nama_kategori\n    FROM objek o\n    LEFT JOIN kategori k ON o.kategori_id = k.id\n    ORDER BY o.id DESC\n  ",function(e,a){if(e)return console.error("Gagal mengambil semua objek:",e),r.status(500).json({error:"Gagal mengambil data"});r.json(a)})}),router.get("/:id",function(e,o){var a=e.params.id;db.query("\n    SELECT o.*, k.nama_kategori \n    FROM objek o \n    LEFT JOIN kategori k ON o.kategori_id = k.id \n    WHERE o.id = ?\n  ",[a],function(e,a){if(e)return console.error("Gagal mengambil detail objek:",e),o.status(500).send("Gagal memuat detail objek");if(0===a.length)return o.status(404).render("error",{message:"Objek tidak ditemukan"});var r=a[0];o.render("detail",{objek:r})})}),module.exports=router;
//# sourceMappingURL=objek.min.js.map
